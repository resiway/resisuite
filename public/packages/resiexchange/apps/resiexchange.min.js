'use strict';String.prototype.toASCII=function(){for(var a,b=this.toLocaleLowerCase(),c='',d={192:'A',193:'A',194:'A',195:'A',196:'A',197:'A',224:'a',225:'a',226:'a',227:'a',228:'a',229:'a',200:'E',201:'E',202:'E',203:'E',232:'e',233:'e',234:'e',235:'e',204:'I',205:'I',206:'I',207:'I',236:'i',237:'i',238:'i',239:'i',210:'O',211:'O',212:'O',213:'O',214:'O',216:'O',240:'o',242:'o',243:'o',244:'o',245:'o',246:'o',217:'U',218:'U',219:'U',220:'U',249:'u',250:'u',251:'u',252:'u'},e=0;e<b.length;e++)a=b.charCodeAt(e),128>a?c+=b.charAt(e):'undefined'!=typeof d[a]&&(c+=d[a]);return c},function(){var a='=',b=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_'.split('');String.prototype.base64_decode=function(){for(var c='',d=this,e=0,f=0,g=0;g<d.length;g+=1){var h=d.charCodeAt(g),i=b[127&h];if(10!=h&&13!=h){if(-1===i)return null;f=f<<6|i,e+=6,e>=8&&(e-=8,a!==d.charAt(g)&&(c+=String.fromCharCode(f>>e&255)),f&=(1<<e)-1)}}return e?null:c},String.prototype.base64_encode=function(){var b,d,e,f='',g=this;if(g.length<3)return null;for(b=0,d=g.length-2;d>b;b+=3){var h=g.charCodeAt(b),i=g.charCodeAt(b+1),j=g.charCodeAt(b+2);f+=c[h>>2],f+=c[((3&h)<<4)+(i>>4)],f+=c[((15&i)<<2)+(j>>6)],f+=c[63&j]}if(e=g.length%3,0!==e){b=g.length-e,f+=c[g[b+0]>>2];var h=g.charCodeAt(b),i=g.charCodeAt(b+1);2===e?(f+=c[((3&h)<<4)+(i>>4)],f+=c[(15&i)<<2],f+=a):(f+=c[(3&h)<<4],f+=a+a)}return f}}();var resiway=angular.module('resiexchange',['ngRoute','ngSanitize','ngCookies','ngAnimate','ui.bootstrap','oi.select','textAngular','pascalprecht.translate','angularMoment','ngToast']).config(['$provide',function(a){a.decorator('taOptions',['taRegisterTool','$delegate',function(a,b){return a('fullScreen',{tooltiptext:'Toogle full screen',iconclass:"fa fa-arrows-alt",activeState:function(){return this.$editor().fullScreen},action:function(){'undefined'==typeof this.$editor().fullScreen&&(this.$editor().fullScreen=!1);var a=this.$editor().displayElements.text.parent().parent(),b=angular.element(document.querySelector('body')),c=angular.element(a.children()[0]);this.$editor().fullScreen?(a.css({position:this.$editor().original_position,width:this.$editor().original_width,height:this.$editor().original_height}),b.append(this.$editor().original_body_content),this.$editor().original_parent.append(a.detach())):(this.$editor().original_width=a.css('width'),this.$editor().original_height=a.css('height'),this.$editor().original_parent=a.parent(),this.$editor().original_position=a.css('position'),this.$editor().original_body_content=b.children().detach(),b.append(a.detach().css({position:'absolute',width:'100%',height:'100%','z-index':'9999',top:'0px',left:'0px'}))),a.css('height','calc(100% - '+c[0].offsetHeight+'px)'),this.$editor().fullScreen=!this.$editor().fullScreen}}),b.toolbar[1].push('fullScreen'),b}])}]).config(['ngToastProvider',function(a){a.configure({animation:'fade'})}]).config(function(){moment.updateLocale(global_config.locale,{calendar:{sameElse:'LLL'}})}).config(['$translateProvider',function(a){'undefined'!=typeof translations&&a.translations(global_config.locale,translations).preferredLanguage(global_config.locale).useSanitizeValueStrategy('sanitize')}]).config(['$httpProvider','$httpParamSerializerJQLikeProvider',function(a,b){a.defaults.headers.post['Content-Type']='application/x-www-form-urlencoded;charset=utf-8',a.defaults.paramSerializer='$httpParamSerializerJQLike',a.defaults.transformRequest.unshift(b.$get())}]).config(['$locationProvider',function(a){a.html5Mode(!1)}]).run(['$window','$timeout','$rootScope','$location','$cookies','authenticationService','actionService','feedbackService',function(a,b,c,d,e,f,g,h){console.log('run method invoked'),c.popover=h;const i='/user/sign';c.viewContentLoading=!0,c.pendingAction=null,c.previousPath='/',c.currentPath=null,c.search={"default":{q:'',domain:[],order:'score',sort:'desc',start:0,limit:25,total:-1},criteria:{}},angular.merge(c.search.criteria,c.search["default"]),c.config=angular.extend({application:'resiway',locale:'fr',channel:1},global_config),c.user={id:0},c.$on('$locationChangeStart',function(a){c.viewContentLoading=!0}),c.$on('$locationChangeSuccess',function(a){console.log('$locationChangeSuccess'),c.currentPath&&(c.previousPath=c.currentPath),c.currentPath=d.path(),console.log('previous path: '+c.previousPath),console.log('current path: '+c.currentPath)}),c.$on('$viewContentLoaded',function(e){console.log('$viewContentLoaded received'),c.viewContentLoading=!1,b(function(){if(d.hash().length){console.log('scroll to element');var b=angular.element(document.querySelector('#'+d.hash()));a.scrollTo(0,b[0].offsetTop-55)}else console.log('scroll to top'),a.scrollTo(0,0);0==c.user.id&&c.previousPath.substring(0,i.length)==i&&c.currentPath.substring(0,i.length)!=i&&(console.log('pending action disgarded'),c.pendingAction=null),c.pendingAction&&c.currentPath.substring(0,i.length)!=i&&(console.log('continuing ation'),console.log(c.pendingAction),c.pendingAction.scope=e.targetScope,g.perform(c.pendingAction))})}),f.setCredentials(e.get('username'),e.get('password')),f.authenticate()}]).controller('rootController',['$rootScope','$scope','$location','$route','$http',function(a,b,c,d,e){console.log('root controller');var f=this;f.search=function(b){var e=angular.extend({},a.search["default"],b||{});angular.copy(e,a.search.criteria),'/questions'==c.path()?(a.$broadcast('$locationChangeStart'),d.reload()):c.path('/questions')},f.makeLink=function(a,b){switch(a){case'resiexchange\\Question':return'#/question/'+b;case'resiexchange\\Answer':return'#/answer/'+b;case'resiway\\Category':return'#/category/'+b}},f.avatarURL=function(a,b){var c=new String(a);return c.replace("@size",b)},f.humanReadable={date:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{weekday:'long',year:'numeric',month:'short',day:'numeric'})}return b},datetime:function(a){var b='',c=Date.parse(a);if(NaN!=c){var d=new Date(c);b=d.toLocaleString('fr',{weekday:'long',year:'numeric',month:'short',day:'numeric',hour:'numeric',minute:'numeric'})}return b},dateInterval:function(a){var b='',c=new Date,d=Date.parse(a);if(NaN!=d){var e=new Date(d),f=Math.floor((c-e)/864e5);if(0==f)return'today';if(7>f)return 1==f?'yesterday':f+" days ago";if(30>f){var g=Math.floor(f/7);return 1==g?'last week':g+" weeks ago"}if(365>f){var h=Math.floor(f/30);return 1==h?'last month':h+" months ago"}var i=Math.floor(f/365);return 1==i?'last year':i+" years ago"}return b},timeElapsed:function(a){var b='',c=new Date,d=Date.parse(a);if(NaN!=d){var e=new Date(d),f=Math.floor((c-e)/864e5);if(0==f)return'today';if(7>f)return f+" days";if(30>f){var g=Math.floor(f/7);return g+" weeks"}if(365>f){var h=Math.floor(f/30);return h+" months"}var i=Math.floor(f/365);return i+" years"}return b},number:function(a){if('undefined'==typeof a||'number'!=typeof parseInt(a))return 0;if(0==a)return 0;var b=a/Math.abs(a);a=Math.abs(a);var c=['','k','M','G'],d=Math.floor(Math.log(a)/Math.log(1e3));return b*(0>=d?a:(a/Math.pow(1e3,d)).toFixed(1))+c[d]}},b.selectMatch=function(a,b,c,d){f.search({q:c})},b.getKeywords=function(a){return e.get('index.php?get=resiway_index_list',{params:{q:a}}).then(function(a){return a.data.result})}}]);angular.module('resiexchange').service('routeObjectProvider',['$http','$route','$q',function(a,b,c){return{provide:function(d){var e=c.defer();return e.resolve({}),'undefined'==typeof b.current.params.id||0==b.current.params.id?e.promise:a.get('index.php?get='+d+'&id='+b.current.params.id).then(function(a){var b=a.data;return'object'!=typeof b.result?{}:b.result},function(a){return e.promise})}}}]).service('routeCategoryProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_category')}}]).service('routeCategoriesProvider',['$http','$rootScope',function(a,b){this.load=function(){return a.get('index.php?get=resiway_category_list&channel='+b.config.channel).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeQuestionsProvider',['$http','$rootScope','$httpParamSerializerJQLike',function(a,b,c){this.load=function(){return a.get('index.php?get=resiexchange_question_list&'+c(b.search.criteria)+'&channel='+b.config.channel).then(function(a){var c=a.data;return'object'!=typeof c.result?(b.search.criteria.total=0,[]):(b.search.criteria.total=c.total,c.result)},function(a){return b.search.criteria.total=0,[]})}}]).service('routeQuestionProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_question').then(function(a){var c={commentsLimit:5,newCommentShow:!1,newCommentContent:'',newAnswerContent:''};return angular.extend(a,c),a.content=b.trustAsHtml(a.content),angular.forEach(a.answers,function(d,e){a.answers[e].content=b.trustAsHtml(a.answers[e].content),angular.extend(a.answers[e],c)}),a})}}]).service('routeAnswerProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_answer').then(function(a){return a.content=b.trustAsHtml(a.content),a})}}]).service('routeUserProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiway_user')}}]).service('routeHelpTopicProvider',['routeObjectProvider','$sce',function(a,b){this.load=function(){return a.provide('resiexchange_help_topic').then(function(a){return a.content=b.trustAsHtml(a.content),a})}}]).service('routeHelpCategoryProvider',['routeObjectProvider',function(a){this.load=function(){return a.provide('resiexchange_help_category')}}]).service('routeHelpCategoriesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiexchange_help_category_list&order=title').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeBadgesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiway_badge_list&order=name').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('routeBadgeCategoriesProvider',['routeObjectProvider','$http',function(a,b){this.load=function(){return b.get('index.php?get=resiway_badgecategory_list&order=name').then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})}}]).service('authenticationService',['$rootScope','$http','$q','$cookies',function(a,b,c,d){var e=this;e.username='',e.password='',e.last_auth_time=0,e.max_auth_delay=3e5,this.userId=function(){var a=c.defer();return b.get('index.php?get=resiway_user_id').then(function(b){'undefined'!=typeof b.data.result&&b.data.result>0?(e.last_auth_time=(new Date).getTime(),a.resolve(b.data.result)):a.reject()},function(b){a.reject()}),a.promise},this.userData=function(a){var d=c.defer();return b.get('index.php?get=resiway_user&id='+a).success(function(b,c,e,f){'object'==typeof b&&'object'==typeof b.result&&b.result.id==a?d.resolve(b.result):d.reject()}).error(function(a,b,c,e){d.reject()}),d.promise},this.setCredentials=function(a,b,c){if(e.username=a,e.password=b,c){var f=new Date,g=new Date(f.getFullYear()+1,f.getMonth(),f.getDate());d.put('username',a,{expires:g}),d.put('password',b,{expires:g})}},this.clearCredentials=function(){console.log('clearing credentials'),e.username='',e.password='',a.user={id:0},d.remove('username'),d.remove('password')},this.signin=function(){var a=c.defer();return'undefined'!=typeof e.username&&'undefined'!=typeof e.password&&e.username.length&&e.password.length?b.get('index.php?do=resiway_user_signin&login='+e.username+'&password='+e.password).then(function(b){return'undefined'==typeof b.data.result?a.reject({result:-1}):b.data.result<0?a.reject(b.data):(e.last_auth_time=(new Date).getTime(),a.resolve(b.data.result))},function(b){return a.reject({result:-1})}):(e.clearCredentials(),a.reject({result:-2})),a.promise},this.register=function(a,d){var e=c.defer();return b.get('index.php?do=resiway_user_signup&login='+a+'&firstname='+d).then(function(a){return a.data.result<0?e.reject(a.data):e.resolve(a.data.result)},function(a){return e.reject({result:-1})}),e.promise},this.authenticate=function(){var b=c.defer(),d=!0;if(a.user.id>0){var f=(new Date).getTime();f-e.last_auth_time<e.max_auth_delay&&(e.last_auth_time=f,d=!1,b.resolve(a.user))}return d&&e.userId().then(function(c){a.user.id>0?b.resolve(a.user):e.userData(c).then(function(c){a.user=c,b.resolve(c)},function(a){console.log('something went wrong server-side'),b.reject(a)})},function(){e.signin().then(function(c){e.userData(c).then(function(c){a.user=c,b.resolve(c)},function(a){b.reject(a)})},function(a){b.reject(a)})}),b.promise}}]).service('actionService',['$rootScope','$http','$location','authenticationService','ngToast',function(a,b,c,d,e){this.perform=function(f){var g={action:'',data:'',next_path:c.path(),scope:null,callback:function(a,b){}},h=angular.extend({},g,f);d.authenticate().then(function(){a.pendingAction=null,'undefined'!=typeof h.action&&h.action.length>0&&b.post('index.php?do='+h.action,h.data).then(function(c){'function'==typeof h.callback&&h.callback(h.scope,c.data),b.get('index.php?do=resiway_user_badges_update').then(function(c){b.get('index.php?get=resiway_user_notifications').then(function(b){var c=b.data;'object'==typeof c.result&&a.user.id>0&&(a.user.notifications=a.user.notifications.concat(c.result),angular.forEach(c.result,function(a,b){e.create({content:a.content,className:'success',dismissOnTimeout:!0,timeout:7e3,dismissButton:!0,dismissButtonHtml:'&times',dismissOnClick:!1,compileContent:!1})}))})})},function(){})},function(){a.pendingAction=h,c.hash(''),c.path('/user/sign')})}}]).service('feedbackService',['$window','$timeout',function(a,b){function c(){e.elem&&(e.elem.triggerHandler('toggle-popover'),e.elem=null)}function d(a){for(var b=angular.element(a),c=angular.element(document.body);('undefined'==typeof b.attr('id')||'undefined'==typeof b.attr('uib-popover-template'))&&(b=b.parent(),b!=c););return'#'+b.attr('id')}var e={content:'',elem:null,classname:null,id:null};return{content:function(){return e.content},classname:function(){var a=document.querySelector('#'+e.id);if(a&&'undefined'!=typeof a){var b=angular.element(a);b.parent().parent().parent().addClass(e.classname)}return e.classname},id:function(){return e.id},popover:function(d,f,g,h,i){c();var j=angular.element(document.querySelector(d));e.content=f,e.elem=j,e.id='popover-'+j.attr('id'),e.classname='popover-'+(g||'danger');var k=j[0].offsetTop;(k<a.pageYOffset||k>a.pageYOffset+a.innerHeight)&&a.scrollTo(0,k-a.innerHeight/4),f.length>0&&(j.triggerHandler('toggle-popover'),e.is_open=!0,h&&b(function(){c()},i||3e3))},close:function(){c()},selector:function(a){return c(),d(a)}}}]),angular.module('resiexchange').config(['$routeProvider','$routeParamsProvider','$httpProvider',function(a,b,c){var d='';a.when('/help/categories',{templateUrl:d+'helpCategories.html',controller:'helpCategoriesController as ctrl',resolve:{categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}}).when('/help/category/edit/:id',{templateUrl:d+'helpCategoryEdit.html',controller:'helpCategoryEditController as ctrl',resolve:{category:['routeHelpCategoryProvider',function(a){return a.load()}]}}).when('/help/category/:id/:title?',{templateUrl:d+'helpCategory.html',controller:'helpCategoryController as ctrl',resolve:{category:['routeHelpCategoryProvider',function(a){return a.load()}]}}).when('/help/topic/edit/:id',{templateUrl:d+'helpTopicEdit.html',controller:'helpTopicEditController as ctrl',resolve:{topic:['routeHelpTopicProvider',function(a){return a.load()}],categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}}).when('/help/topic/:id/:title?',{templateUrl:d+'helpTopic.html',controller:'helpTopicController as ctrl',resolve:{topic:['routeHelpTopicProvider',function(a){return a.load()}],categories:['routeHelpCategoriesProvider',function(a){return a.load()}]}}).when('/badges',{templateUrl:d+'badges.html',controller:'badgesController as ctrl',resolve:{categories:['routeBadgeCategoriesProvider',function(a){return a.load()}]}}).when('/categories',{templateUrl:d+'categories.html',controller:'categoriesController as ctrl',resolve:{categories:['routeCategoriesProvider',function(a){return a.load()}]}}).when('/category/edit/:id',{templateUrl:d+'categoryEdit.html',controller:'categoryEditController as ctrl',resolve:{category:['routeCategoryProvider',function(a){return a.load()}]}}).when('/category/:id',{templateUrl:d+'category.html',controller:'categoryController as ctrl',resolve:{category:['routeCategoryProvider',function(a){return a.load()}]}}).when('/questions',{templateUrl:d+'questions.html',controller:'questionsController as ctrl',resolve:{questions:['routeQuestionsProvider',function(a){return a.load()}]}}).when('/question/edit/:id',{templateUrl:d+'questionEdit.html',controller:'questionEditController as ctrl',resolve:{question:['routeQuestionProvider',function(a){return a.load()}]}}).when('/question/:id/:title?',{templateUrl:d+'question.html',controller:'questionController as ctrl',resolve:{question:['routeQuestionProvider',function(a){return a.load()}]}}).when('/answer/edit/:id',{templateUrl:d+'answerEdit.html',controller:'answerEditController as ctrl',resolve:{answer:['routeAnswerProvider',function(a){return a.load()}]}}).when('/answer/:id',{templateUrl:d+'question.html',controller:['$location','routeAnswerProvider',function(a,b){b.load().then(function(b){a.path('/question/'+b.question_id)})}]}).when('/user/current/profile',{templateUrl:d+'userProfile.html',controller:['$location','authenticationService',function(a,b){b.userId().then(function(b){a.path('/user/profile/'+b)})}]}).when('/user/current/edit',{templateUrl:d+'userEdit.html',controller:['$location','authenticationService',function(a,b){b.userId().then(function(b){a.path('/user/edit/'+b)})}]}).when('/user/edit/:id',{templateUrl:d+'userEdit.html',controller:'userEditController as ctrl',resolve:{user:['routeUserProvider',function(a){return a.load()}]}}).when('/user/profile/:id/:name?',{templateUrl:d+'userProfile.html',controller:'userProfileController as ctrl',resolve:{user:['routeUserProvider',function(a){return a.load()}]}}).when('/user/password/:code?',{templateUrl:d+'userPassword.html',controller:'userPasswordController as ctrl'}).when('/user/confirm/:code',{templateUrl:d+'userConfirm.html',controller:'userConfirmController as ctrl'}).when('/user/notifications/:id',{templateUrl:d+'userNotifications.html',controller:'userNotificationsController as ctrl'}).when('/user/sign/:mode?',{templateUrl:d+'userSign.html',controller:'userSignController as ctrl',reloadOnSearch:!1}).when('/association/soutenir',{templateUrl:d+'support.html',controller:'emptyController as ctrl'}).when('/association/participer',{templateUrl:d+'participate.html',controller:'emptyController as ctrl'}).when('/association/mentions-legales',{templateUrl:d+'legal.html',controller:'emptyController as ctrl'}).when('/association',{templateUrl:d+'organisation.html',controller:'emptyController as ctrl'}).otherwise({templateUrl:d+'home.html',controller:'homeController as ctrl'})}]),angular.module('resiexchange').filter("nl2br",function(){return function(a){return a?a.replace(/\n\r?/g,'<br />'):a}}).filter('size',function(){return function(a,b){return a=a||'',a.replace(new RegExp('<size>','gi'),b)}}).filter("humanizeCount",function(){return function(a,b){if(b)return a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");if('undefined'==typeof a||'number'!=typeof parseInt(a))return 0;if(0==a)return 0;var c=a/Math.abs(a);a=Math.abs(a);var d=['','k','M','G'],e=Math.floor(Math.log(a)/Math.log(1e3));return c*(0>=e?a:(a/Math.pow(1e3,e)).toFixed(1))+d[e]}}).filter('customSearchFilter',['$sce',function(a){return function(b,c,d,e,f){var g='<span class="close select-search-list-item_selection-remove">Ã—</span>';return a.trustAsHtml(d.title+g)}}]).filter('customDropdownFilter',['$sce','oiSelectEscape',function(a,b){return function(c,d,e){var f,c=new String(e.title),g=new String(e.path);return d.length>0||angular.isNumber(d)?(d=b(d),f=c.replace(new RegExp(d,'gi'),'<strong>$&</strong>')+' <span style="color: grey; font-style: italic; font-size: 80%;">('+g.replace(new RegExp(d,'gi'),'<strong>$&</strong>')+')</span>'):f=c+" <span style=\"color: grey; font-style: italic; font-size: 80%;\">("+g+')</span>',a.trustAsHtml(f)}}]).filter('customListFilter',['oiSelectEscape',function(a){function b(b,c,d,e){var f,g,h,i,j=[],k=[],l=[],m=[];if(c){for(c=a(c).toASCII().toLowerCase(),f=0,h=!1;f<b.length;f++){if(h=b[f].title.toASCII().toLowerCase().match(new RegExp(c)),!h&&e&&(e.length||e.fields))for(g=0;g<e.length&&!h;g++)h=String(b[f][e[g]]).toASCII().toLowerCase().match(new RegExp(c));h&&j.push(b[f])}for(f=0;f<j.length;f++)d(j[f]).toASCII().toLowerCase().match(new RegExp('^'+c))?k.push(j[f]):l.push(j[f]);if(i=k.concat(l),e&&(e===!0||e.all)){a:for(f=0;f<b.length;f++){for(g=0;g<i.length;g++)if(b[f]===i[g])continue a;m.push(b[f])}i=i.concat(m)}}else i=[].concat(b);return i}return b}]),angular.module('resiexchange').controller('answerEditController',['answer','$scope','$window','$location','$sce','feedbackService','actionService','textAngularManager',function(a,b,c,d,e,f,g,h){console.log('answerEdit controller');b.answer=a,b.answerPost=function(a){var c=f.selector(a.target);g.perform({action:'resiexchange_answer_edit',data:{answer_id:b.answer.id,content:b.answer.content},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],g=e;'missing_'==g.substr(0,8)&&(g='answer_'+g),f.popover(c,g)}else{var h=b.result.question_id;d.path('/question/'+h)}}})}}]),angular.module('resiexchange').controller('badgesController',['categories','$scope','$http','authenticationService',function(a,b,c,d){console.log('badges controller');angular.forEach(a,function(b,c){a[c].groups={},angular.forEach(b.badges,function(b,d){'undefined'==typeof a[c].groups[b.group]&&(a[c].groups[b.group]=[]),a[c].groups[b.group].push(b)})}),d.userId().then(function(a){c.post('index.php?get=resiway_userbadge_list',{domain:['user_id','=',a],start:0,limit:100}).then(function(a){var c=a.data;angular.forEach(c.result,function(a,c){b.userBadges.push(a.badge_id)})})}),b.userBadges=[],b.badgeCategories=a}]),angular.module('resiexchange').controller('categoriesController',['categories','$scope','$http',function(a,b,c){console.log('categories controller');var d=this;d.config={items:a,total:-1,currentPage:1,previousPage:-1,limit:30,domain:[],loading:!1},d.load=function(a){a.currentPage!=a.previousPage&&(a.previousPage=a.currentPage,a.total>0&&(a.loading=!0),c.post('index.php?get=resiway_category_list',{domain:a.domain,start:(a.currentPage-1)*a.limit,limit:a.limit,total:a.total}).then(function(b){var c=b.data;a.items=c.result,a.total=c.total,a.loading=!1},function(){}))},d.load(d.config)}]),angular.module('resiexchange').controller('categoryEditController',['category','$scope','$window','$location','feedbackService','actionService','$http','$httpParamSerializerJQLike',function(a,b,c,d,e,f,g,h){console.log('categoryEdit controller');b.category=a,b.loadMatches=function(a){return a.length<2?[]:g.get('index.php?get=resiway_category_list&order=title&'+h({channel:global_config.channel,domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},b.$watch('category.parent',function(){b.category.parent_id=b.category.parent.id}),b.category.parent={id:a.parent_id,title:a['parent_id.title'],path:a['parent_id.path']},b.categoryPost=function(a){var c=e.selector(angular.element(a.target));f.perform({action:'resiway_category_edit',data:{category_id:b.category.id,title:b.category.title,description:b.category.description,parent_id:b.category.parent_id},scope:b,callback:function(a,b){if('object'!=typeof b.result){var f=b.error_message_ids[0],g=f;'missing_'==g.substr(0,8)&&(g='category_'+g),e.popover(c,g)}else d.path('/categories')}})}}]),angular.module('resiexchange').controller('emptyController',['$scope',function(a){console.log('empty controller')}]),angular.module('resiexchange').controller('helpCategoriesController',['categories','$scope',function(a,b){console.log('helpCategories controller');var c=this;c.categories=a}]),angular.module('resiexchange').controller('helpCategoryController',['category','$scope',function(a,b){console.log('helpCategory controller');var c=this;c.category=a}]),angular.module('resiexchange').controller('helpCategoryEditController',['category','$scope','$location','feedbackService','actionService',function(a,b,c,d,e){console.log('helpCategoryEdit controller');var f=this;f.category=angular.extend({title:'',description:''},a),b.categoryPost=function(a){var g=d.selector(a.target);e.perform({action:'resiexchange_helpcategory_edit',data:{category_id:f.category.id,title:f.category.title,description:f.category.description},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;d.popover(g,f)}else{var h=b.result.id;c.path('/help/category/'+h)}}})}}]),angular.module('resiexchange').controller('helpTopicController',['topic','categories','$scope',function(a,b,c){console.log('helpTopic controller');var d=this;d.topic=a,d.categories=b}]),angular.module('resiexchange').controller('helpTopicEditController',['topic','categories','$scope','$location','$sce','feedbackService','actionService',function(a,b,c,d,e,f,g){console.log('hepTopicEdit controller');var h=this;a.content=e.valueOf(a.content),h.topic=angular.extend({id:0,title:'',content:'',category_id:0},a),h.categories=b,c.category=null,angular.forEach(h.categories,function(a,b){a.id==h.topic.category_id&&(c.category=a)}),c.$watch('category',function(){h.topic.category_id=c.category.id}),c.topicPost=function(a){var b=f.selector(a.target);g.perform({action:'resiexchange_helptopic_edit',data:{topic_id:h.topic.id,title:h.topic.title,content:h.topic.content,category_id:h.topic.category_id},scope:c,callback:function(a,c){if('object'!=typeof c.result){var e=c.error_message_ids[0],g=e;f.popover(b,g)}else{var h=c.result.id;d.path('/help/topic/'+h)}}})}}]),angular.module('resiexchange').controller('homeController',['$http','$rootScope',function(a,b){console.log('home controller');var c=this;c.questions=[],a.get('index.php?get=resiexchange_stats').then(function(a){var b=a.data;'object'==typeof a.data.result&&(c.count_questions=b.result['resiexchange.count_questions'],c.count_answers=b.result['resiexchange.count_answers'],c.count_comments=b.result['resiexchange.count_comments'],c.count_users=b.result['resiway.count_users'])},function(){}),a.get('index.php?get=resiexchange_question_list&order=score&limit=5&sort=desc').then(function(a){a.data;'object'==typeof a.data.result&&(c.questions=a.data.result)},function(){})}]),angular.module('resiexchange').controller('questionController',['question','$scope','$window','$location','$http','$sce','$timeout','$uibModal','actionService','feedbackService','textAngularManager',function(a,b,c,d,e,f,g,h,i,j,k){console.log('question controller');var l=this;b.question=a,b.related_questions=[],e.get('index.php?get=resiexchange_question_related&question_id='+a.id).then(function(a){b.related_questions=a.data.result}),l.open=function(a,b,c){return h.open({animation:!0,ariaLabelledBy:'modal-title',ariaDescribedBy:'modal-body',templateUrl:'modalCustom.html',controller:['$uibModalInstance',function(d,e){var f=this;f.title_id=a,f.header_id=b,f.body=c,f.ok=function(){d.close()},f.cancel=function(){d.dismiss()}}],controllerAs:'ctrl',size:'md',appendTo:angular.element(document.querySelector(".modal-wrapper")),resolve:{items:function(){return l.items}}}).result},b.begin=function(a,c){b.committed=!1,b.previous=angular.merge({},c),a(b),b.committed=!0},b.rollback=function(){angular.isDefined(b.previous)&&'object'==typeof b.previous&&angular.merge(b.question,b.previous)},b.questionComment=function(a){var c=j.selector(a.target);i.perform({action:'resiexchange_question_comment',data:{question_id:b.question.id,content:b.question.newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var d=b.error_message_ids[0],e=d;j.popover(c,e)}else{var f=b.result.id;a.question.comments.push(b.result),a.question.newCommentShow=!1,a.question.newCommentContent='',g(function(){j.popover('#comment-'+f,'')})}}})},b.questionFlag=function(a){var c=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.history.resiexchange_question_flag)||(a.question.history.resiexchange_question_flag=!1),a.question.history.resiexchange_question_flag===!0?a.question.history.resiexchange_question_flag=!1:a.question.history.resiexchange_question_flag=!0)};b.begin(c,{history:{resiexchange_question_flag:b.question.history.resiexchange_question_flag}});var d=j.selector(a.target);i.perform({action:'resiexchange_question_flag',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else c(a)}})},b.questionAnswer=function(a){var c=j.selector(a.target);i.perform({action:'resiexchange_question_answer',data:{question_id:b.question.id,content:b.question.newAnswerContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var d=b.error_message_ids[0],e=d;j.popover(c,e)}else{var h=b.result.id;b.result.content=f.trustAsHtml(b.result.content),b.result.commentsLimit=5,b.result.newCommentShow=!1,b.result.newCommentContent='',a.question.answers.push(b.result),a.question.history.resiexchange_question_answer=!0,g(function(){j.popover('#answer-'+h,'')})}}})},b.questionVoteUp=function(a){var c=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.history.resiexchange_question_votedown)||(a.question.history.resiexchange_question_votedown=!1),angular.isDefined(a.question.history.resiexchange_question_voteup)||(a.question.history.resiexchange_question_voteup=!1),a.question.history.resiexchange_question_voteup===!0?(a.question.history.resiexchange_question_voteup=!1,a.question.score--):(a.question.history.resiexchange_question_votedown===!0&&(a.question.history.resiexchange_question_votedown=!1,a.question.score++),a.question.history.resiexchange_question_voteup=!0,a.question.score++))};b.begin(c,{history:{resiexchange_question_votedown:b.question.history.resiexchange_question_votedown,resiexchange_question_voteup:b.question.history.resiexchange_question_voteup},score:b.question.score});var d=j.selector(a.target);i.perform({action:'resiexchange_question_voteup',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result>=0)c(a),b.result===!0&&j.popover(d,'QUESTION_ACTIONS_VOTEUP_OK','info',!0);else{a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})},b.questionVoteDown=function(a){var c=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.history.resiexchange_question_votedown)||(a.question.history.resiexchange_question_votedown=!1),angular.isDefined(a.question.history.resiexchange_question_voteup)||(a.question.history.resiexchange_question_voteup=!1),a.question.history.resiexchange_question_votedown===!0?(a.question.history.resiexchange_question_votedown=!1,a.question.score--):(a.question.history.resiexchange_question_voteup===!0&&(a.question.history.resiexchange_question_voteup=!1,a.question.score--),a.question.history.resiexchange_question_votedown=!0,a.question.score--))};b.begin(c,{history:{resiexchange_question_votedown:b.question.history.resiexchange_question_votedown,
resiexchange_question_voteup:b.question.history.resiexchange_question_voteup},score:b.question.score});var d=j.selector(a.target);i.perform({action:'resiexchange_question_votedown',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result>=0)c(a);else{a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})},b.questionStar=function(a){var c=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.history.resiexchange_question_star)||(a.question.history.resiexchange_question_star=!1),a.question.history.resiexchange_question_star===!0?(a.question.history.resiexchange_question_star=!1,a.question.count_stars--):(a.question.history.resiexchange_question_star=!0,a.question.count_stars++))};b.begin(c,{history:{resiexchange_question_star:b.question.history.resiexchange_question_star},count_stars:b.question.count_stars});var d=j.selector(a.target);i.perform({action:'resiexchange_question_star',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var e=b.error_message_ids[0],f=e;j.popover(d,f)}else c(a)}})},b.questionCommentVoteUp=function(a,c){var d=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.comments[c].history.resiexchange_questioncomment_voteup)||(a.question.comments[c].history.resiexchange_questioncomment_voteup=!1),a.question.comments[c].history.resiexchange_questioncomment_voteup===!0?(a.question.comments[c].history.resiexchange_questioncomment_voteup=!1,a.question.comments[c].score--):(a.question.comments[c].history.resiexchange_questioncomment_voteup=!0,a.question.comments[c].score++))};b.begin(d,{comments:b.question.comments});var e=j.selector(a.target);i.perform({action:'resiexchange_questioncomment_voteup',data:{comment_id:b.question.comments[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.questionDelete=function(a){var c=j.selector(a.target);l.open('MODAL_QUESTION_DELETE_TITLE','MODAL_QUESTION_DELETE_HEADER',b.question.title).then(function(){i.perform({action:'resiexchange_question_delete',data:{question_id:b.question.id},scope:b,callback:function(a,b){if(b.result===!0)d.path('/questions');else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(c,f)}}})})},b.answerVoteUp=function(a,c){var d=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.answers[c].history.resiexchange_answer_votedown)||(a.question.answers[c].history.resiexchange_answer_votedown=!1),angular.isDefined(a.question.answers[c].history.resiexchange_answer_voteup)||(a.question.answers[c].history.resiexchange_answer_voteup=!1),a.question.answers[c].history.resiexchange_answer_voteup===!0?(a.question.answers[c].history.resiexchange_answer_voteup=!1,a.question.answers[c].score--):(a.question.answers[c].history.resiexchange_answer_votedown===!0&&(a.question.answers[c].history.resiexchange_answer_votedown=!1,a.question.answers[c].score++),a.question.answers[c].history.resiexchange_answer_voteup=!0,a.question.answers[c].score++))};b.begin(d,{answers:b.question.answers});var e=j.selector(a.target);i.perform({action:'resiexchange_answer_voteup',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result>=0)d(a),b.result===!0&&j.popover(e,'QUESTION_ACTIONS_VOTEUP_OK','info',!0);else{a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})},b.answerVoteDown=function(a,c){var d=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.answers[c].history.resiexchange_answer_votedown)||(a.question.answers[c].history.resiexchange_answer_votedown=!1),angular.isDefined(a.question.answers[c].history.resiexchange_answer_voteup)||(a.question.answers[c].history.resiexchange_answer_voteup=!1),a.question.answers[c].history.resiexchange_answer_votedown===!0?(a.question.answers[c].history.resiexchange_answer_votedown=!1,a.question.answers[c].score++):(a.question.answers[c].history.resiexchange_answer_voteup===!0&&(a.question.answers[c].history.resiexchange_answer_voteup=!1,a.question.answers[c].score--),a.question.answers[c].history.resiexchange_answer_votedown=!0,a.question.answers[c].score--))};b.begin(d,{answers:b.question.answers});var e=j.selector(a.target);i.perform({action:'resiexchange_answer_votedown',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result>=0)d(a);else{var c=b.error_message_ids[0],f=c;j.popover(e,f)}}})},b.answerFlag=function(a,c){var d=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.answers[c].history.resiexchange_answer_flag)||(a.question.answers[c].history.resiexchange_answer_flag=!1),a.question.answers[c].history.resiexchange_answer_flag===!0?a.question.answers[c].history.resiexchange_answer_flag=!1:a.question.answers[c].history.resiexchange_answer_flag=!0)};b.begin(d,{answers:b.question.answers});var e=j.selector(a.target);i.perform({action:'resiexchange_answer_flag',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],f=c;j.popover(e,f)}else d(a)}})},b.answerComment=function(a,c){var d=j.selector(a.target);i.perform({action:'resiexchange_answer_comment',data:{answer_id:b.question.answers[c].id,content:b.question.answers[c].newCommentContent},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;j.popover(d,f)}else{var h=a.question.answers[c].id,i=b.result.id;a.question.answers[c].comments.push(b.result),a.question.answers[c].newCommentShow=!1,a.question.answers[c].newCommentContent='',g(function(){j.popover('#comment-'+h+'-'+i,'')})}}})},b.answerCommentVoteUp=function(a,c,d){var e=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup)||(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=!1),a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup===!0?(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=!1,a.question.answers[c].comments[d].score--):(a.question.answers[c].comments[d].history.resiexchange_answercomment_voteup=!0,a.question.answers[c].comments[d].score++))};b.begin(e,{answers:b.question.answers});var f=j.selector(a.target);i.perform({action:'resiexchange_answercomment_voteup',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;j.popover(f,d)}else e(a)}})},b.answerCommentFlag=function(a,c,d){var e=function(a){angular.isDefined(a.committed)&&a.committed||(angular.isDefined(a.question.answers[c].comments[d].history.resiexchange_answercomment_flag)||(a.question.answers[c].comments[d].history.resiexchange_answercomment_flag=!1),a.question.answers[c].comments[d].history.resiexchange_answercomment_flag===!0?a.question.answers[c].comments[d].history.resiexchange_answercomment_flag=!1:a.question.answers[c].comments[d].history.resiexchange_answercomment_flag=!0)};b.begin(e,{answers:b.question.answers});var f=j.selector(a.target);i.perform({action:'resiexchange_answercomment_flag',data:{comment_id:b.question.answers[c].comments[d].id},scope:b,callback:function(a,b){if(b.result<0){a.rollback();var c=b.error_message_ids[0],d=c;j.popover(f,d)}else e(a)}})},b.answerDelete=function(a,c){var d=j.selector(a.target);l.open('MODAL_ANSWER_DELETE_TITLE','MODAL_ANSWER_DELETE_HEADER',b.question.answers[c].content_excerpt).then(function(){i.perform({action:'resiexchange_answer_delete',data:{answer_id:b.question.answers[c].id},scope:b,callback:function(a,b){if(b.result===!0)a.question.answers.splice(c,1),a.question.history.resiexchange_question_answer=!1;else if(b.result===!1);else{var e=b.error_message_ids[0],f=e;j.popover(d,f)}}})})}}]),angular.module('resiexchange').controller('questionEditController',['question','$scope','$window','$location','$sce','feedbackService','actionService','textAngularManager','$http','$httpParamSerializerJQLike',function(a,b,c,d,e,f,g,h,i,j){console.log('questionEdit controller');b.addItem=function(a){return{id:null,title:a,path:a,parent_id:0,parent_path:''}},b.loadMatches=function(a){return a.length<2?[]:i.get('index.php?get=resiway_category_list&order=title&'+j({domain:['title','ilike','%'+a+'%']})).then(function(a){var b=a.data;return'object'!=typeof b.result?[]:b.result},function(a){return[]})},a.content=e.valueOf(a.content),b.question=angular.merge({id:0,title:'',content:'',tags_ids:[{}]},a),b.initial_tags_ids=[],angular.forEach(b.question.tags,function(a,c){b.initial_tags_ids.push('-'+a.id)}),b.$watch('question.tags',function(){b.question.tags_ids=angular.copy(b.initial_tags_ids),angular.forEach(b.question.tags,function(a,c){b.question.tags_ids.push(null==a.id?a.title:'+'+a.id)})}),b.questionPost=function(a){var c=f.selector(angular.element(a.target));g.perform({action:'resiexchange_question_edit',data:{question_id:b.question.id,title:b.question.title,content:b.question.content,tags_ids:b.question.tags_ids},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],g=e;'missing_'==g.substr(0,8)&&(g='question_'+g),f.popover(c,g)}else{var h=b.result.id;d.path('/question/'+h)}}})}}]),angular.module('resiexchange').controller('questionsController',['questions','$scope','$rootScope','$route','$http','$httpParamSerializerJQLike','$window',function(a,b,c,d,e,f,g){console.log('questions controller');var h=this;angular.merge(h,{questions:{items:a,total:c.search.total,currentPage:1,previousPage:-1,limit:c.search.criteria.limit}}),h.load=function(){h.questions.currentPage!=h.questions.previousPage&&(h.questions.previousPage=h.questions.currentPage,h.questions.items=-1,c.search.criteria.start=(h.questions.currentPage-1)*h.questions.limit,e.get('index.php?get=resiexchange_question_list&'+f(c.search.criteria)).then(function(a){var b=a.data;'object'!=typeof b.result&&(h.questions.items=[]),h.questions.items=b.result,g.scrollTo(0,0)},function(a){return[]}))},h.categories=[],angular.forEach(c.search.criteria.domain,function(a,c){'categories_ids'==a[0]&&(b.related_categories=[],'object'!=typeof a[2]&&(a[2]=[a[2]]),h.categories=a[2])}),h.categories.length>0&&(e.get('index.php?get=resiway_category_list&'+f({domain:['id','in',h.categories]})).then(function(a){var c=a.data;'object'==typeof c.result&&(b.categories=c.result)}),angular.forEach(h.categories,function(a,c){e.get('index.php?get=resiway_category_related&category_id='+a).then(function(a){var c=a.data;'object'==typeof c.result&&(b.related_categories=c.result)})})),e.get('index.php?get=resiway_category_list&limit=15&order=count_questions&sort=desc').then(function(a){var c=a.data;'object'==typeof c.result&&(b.featured_categories=c.result)})}]),angular.module('resiexchange').controller('topBarCtrl',['$scope','$rootScope','$document','$http','actionService','authenticationService',function(a,b,c,d,e,f){function g(){i.platformDropdown=!1,i.userDropdown=!1,i.notifyDropdown=!1,i.helpDropdown=!1}function h(b){if(b)for(var d=angular.element(b.target).scope();d;){if(a.$id==d.$id)return!1;d=d.$parent}a.$apply(function(){g(),c.off('click',h)})}console.log('topbar controller');var i=this;i.platformDropdown=!1,i.userDropdown=!1,i.notifyDropdown=!1,i.helpDropdown=!1,angular.element(document.querySelectorAll('#topBar a')).on('click',function(){g()}),a.togglePlatformDropdown=function(){var a=i.platformDropdown;g(),a?c.off('click',h):c.on('click',h),i.platformDropdown=!a},a.toggleUserDropdown=function(){var a=i.userDropdown;g(),a?c.off('click',h):c.on('click',h),i.userDropdown=!a},a.toggleNotifyDropdown=function(){var a=i.notifyDropdown;g(),a?c.off('click',h):c.on('click',h),i.notifyDropdown=!a},a.toggleHelpDropdown=function(){var a=i.helpDropdown;g(),a?c.off('click',h):c.on('click',h),i.helpDropdown=!a},i.signOut=function(){e.perform({action:'resiway_user_signout',next_path:'/',callback:function(a,b){f.clearCredentials()}})},i.notificationsDismissAll=function(){b.user.notifications=[],d.get('index.php?do=resiway_notification_dismiss-all')}}]),angular.module('resiexchange').controller('userConfirmController',['$scope','$rootScope','$routeParams','$http','authenticationService',function(a,b,c,d,e){console.log('userConfirm controller');var f=this;f.code=c.code,f.verified=!1,f.password_updated=!1,f.closeAlerts=function(){a.alerts=[]},a.password='',a.confirm='',a.alerts=[],d.get('index.php?do=resiway_user_confirm&code='+f.code).then(function(a){var c=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(f.verified=c.result,'undefined'!=typeof c.notifications&&c.notifications.length>0&&(b.user.notifications=b.user.notifications.concat(c.notifications)),e.authenticate())},function(){}),f.passwordReset=function(){a.alerts=[],0==a.password.length||a.password!=a.confirm?0==a.password.length?a.alerts.push({type:'warning',msg:'Please, provide a new password.'}):0==a.confirm.length?a.alerts.push({type:'warning',msg:'Please, re-type your new password.'}):a.password!=a.confirm&&a.alerts.push({type:'warning',msg:'Confirmation does not match the specified password.'}):d.get('index.php?do=resiway_user_passwordreset&password='+md5(a.password)+'&confirm='+md5(a.confirm)).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(f.password_updated=b.result)},function(){})}}]),angular.module('resiexchange').controller('userEditController',['user','$scope','$window','$filter','$http','$translate','feedbackService','actionService',function(a,b,c,d,e,f,g,h){console.log('userEdit controller');var i=this;return i.user=a,0==Object.keys(a).length?void console.log('empty object'):(i.publicity_mode={id:1,text:'Fullname'},i.modes=[{id:1,text:'Fullname'},{id:2,text:'Firstname + Lastname inital'},{id:3,text:'Firstname only'}],f(['USER_EDIT_PUBLICITY_MODE_FULLNAME','USER_EDIT_PUBLICITY_MODE_FIRSTNAME_L','USER_EDIT_PUBLICITY_MODE_FIRSTNAME']).then(function(a){i.modes[0].text=a.USER_EDIT_PUBLICITY_MODE_FULLNAME,i.modes[1].text=a.USER_EDIT_PUBLICITY_MODE_FIRSTNAME_L,i.modes[2].text=a.USER_EDIT_PUBLICITY_MODE_FIRSTNAME}).then(function(){angular.forEach(i.modes,function(a){a.id==i.user.publicity_mode&&(i.publicity_mode={id:a.id,text:a.text})})}),i.avatars={libravatar:'https://seccdn.libravatar.org/avatar/'+md5(i.user.login)+'?s=@size',gravatar:'https://www.gravatar.com/avatar/'+md5(i.user.login)+'?s=@size',identicon:'https://www.gravatar.com/avatar/'+md5(i.user.firstname+i.user.id)+'?d=identicon&s=@size',google:''},e.get('https://picasaweb.google.com/data/entry/api/user/'+i.user.login+'?alt=json').then(function(a){var b=a.data.entry.gphoto$thumbnail.$t;i.avatars.google=b.replace("/s64-c/","/")+'?sz=@size'},function(a){}),b.$watchGroup([function(){return i.publicity_mode},function(){return i.user.firstname},function(){return i.user.lastname}],function(){switch(i.user.publicity_mode=i.publicity_mode.id,i.user.publicity_mode){case 1:i.user.display_name=i.user.firstname+' '+i.user.lastname;break;case 2:var a='';i.user.lastname.length&&(a=i.user.lastname.substr(0,1)+'.'),i.user.display_name=i.user.firstname+' '+a;break;case 3:i.user.display_name=i.user.firstname}}),void(i.userPost=function(a){var d=g.selector(angular.element(a.target));h.perform({action:'resiway_user_edit',data:{id:i.user.id,firstname:i.user.firstname,lastname:i.user.lastname,publicity_mode:i.user.publicity_mode,language:i.user.language,country:i.user.country,location:i.user.location,about:i.user.about,avatar_url:i.user.avatar_url,notify_reputation_update:i.user.notify_reputation_update,notify_badge_awarded:i.user.notify_badge_awarded,notify_question_comment:i.user.notify_question_comment,notify_answer_comment:i.user.notify_answer_comment,notify_question_answer:i.user.notify_question_answer},scope:b,callback:function(a,b){if('object'!=typeof b.result){var e=b.error_message_ids[0],f=e;g.popover(d,f)}else c.scrollTo(0,0),a.showMessage=!0}})}))}]),angular.module('resiexchange').controller('userNotificationsController',['$scope','$rootScope','actionService','feedbackService',function(a,b,c,d){console.log('userNotifications controller');var e=this;e.dismiss=function(e,f){var g=d.selector(e.target);c.perform({action:'resiway_notification_dismiss',data:{notification_id:b.user.notifications[f].id},scope:a,callback:function(a,c){if(c.result===!0)b.user.notifications.splice(f,1);else{var e=c.error_message_ids[0],h=e;d.popover(g,h)}}})}}]),angular.module('resiexchange').controller('userPasswordController',['$scope','$routeParams','$http','authenticationService',function(a,b,c,d){console.log('userPassword controller');var e=this;if(a.password='',a.confirm='',a.alerts=[],e.code=b.code,e.password_updated=!1,e.closeAlerts=function(){a.alerts=[]},'undefined'!=typeof e.code){var f=String(e.code).base64_decode();if(f.indexOf(';')>0){var g=f.split(';');c.get('index.php?do=resiway_user_signin&login='+g[0]+'&password='+g[1]).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result>0&&(e.verified=b.result,d.authenticate())},function(){})}}e.passwordReset=function(){a.alerts=[],0==a.password.length||a.password!=a.confirm?0==a.password.length?a.alerts.push({type:'warning',msg:'Please, provide a new password.'}):0==a.confirm.length?a.alerts.push({type:'warning',msg:'Please, re-type your new password.'}):a.password!=a.confirm&&a.alerts.push({type:'warning',msg:'Confirmation does not match the specified password.'}):c.get('index.php?do=resiway_user_passwordreset&password='+md5(a.password)+'&confirm='+md5(a.confirm)).then(function(a){var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(e.password_updated=b.result)},function(){})}}]),angular.module('resiexchange').controller('userProfileController',['user','$scope','$http',function(a,b,c){console.log('userProfile controller');var d=this;d.user=a,c.get('index.php?do=resiway_user_profileview&id='+a.id),d.load=function(a){a.currentPage!=a.previousPage&&(a.previousPage=a.currentPage,a.items=-1,c.post('index.php?get='+a.provider,{domain:a.domain,start:(a.currentPage-1)*a.limit,limit:a.limit,total:a.total}).then(function(b){var c=b.data;a.items=c.result,a.total=c.total},function(){}))},angular.merge(d,{updates:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:[[['user_id','=',d.user.id],['user_increment','<>',0]],[['author_id','=',d.user.id],['author_increment','<>',0]]],provider:'resiway_actionlog_list'},badges:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['user_id','=',d.user.id],provider:'resiway_userbadge_list'},questions:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['creator','=',d.user.id],provider:'resiexchange_question_list'},answers:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:['creator','=',d.user.id],provider:'resiexchange_answer_list'},favorites:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:[['user_id','=',d.user.id],['action_id','=','4']],provider:'resiway_actionlog_list'},actions:{items:-1,total:-1,currentPage:1,previousPage:-1,limit:5,domain:[['user_id','=',d.user.id]],provider:'resiway_actionlog_list'}})}]),angular.module('resiexchange').controller('userSignController',['$scope','$rootScope','$location','$routeParams','$http','authenticationService',function(a,b,c,d,e,f){console.log('userSign controller');var g=this;switch(g.mode='',d.mode){case'recover':case'in':case'up':g.mode=d.mode}a.remember=!0,a.username='',a.password='',a.firstname='',a.email='',a.signInAlerts=[],a.signUpAlerts=[],a.recoverAlerts=[],g.recovery_sent=!1,g.closeSignInAlerts=function(){a.signInAlerts=[]},g.closeSignInAlert=function(b){a.signInAlerts.splice(b,1)},g.closeSignUpAlerts=function(){a.signUpAlerts=[]},g.closeSignUpAlert=function(b){a.signUpAlerts.splice(b,1)},g.closeRecoverAlerts=function(){a.recoverAlerts=[]},g.closeRecoverAlert=function(b){a.recoverAlerts.splice(b,1)},g.signIn=function(){0==a.username.length||0==a.password.length?0==a.username.length?a.signInAlerts.push({type:'warning',msg:'Please, provide your email as identifier.'}):0==a.password.length&&a.signInAlerts.push({type:'warning',msg:'Please, provide your password.'}):(g.running=!0,g.closeSignInAlerts(),f.setCredentials(a.username,md5(a.password),a.remember),f.authenticate().then(function(a){g.running=!1,c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)},function(){g.running=!1,f.clearCredentials(),a.signInAlerts=[{type:'danger',msg:'Email or password mismatch.'}]}))},g.signUp=function(){0==a.username.length||0==a.firstname.length?0==a.firstname.length?a.signUpAlerts.push({type:'warning',msg:'Please, indicate your firstname.'}):0==a.username.length&&a.signUpAlerts.push({type:'warning',msg:'Please, provide your email as username.'}):(g.running=!0,g.closeSignUpAlerts(),f.register(a.username,a.firstname).then(function(d){g.running=!1,f.authenticate().then(function(a){e.get('index.php?do=resiway_user_pull'),c.path(b.pendingAction&&'undefined'!=typeof b.pendingAction.next_path?b.pendingAction.next_path:b.previousPath)},function(b){f.clearCredentials(),a.signUpAlerts=[{type:'danger',msg:'Sorry, an unexpected error occured.'}]})},function(b){g.running=!1;var c=b.error_message_ids[0];a.signUpAlerts=[{type:'danger',msg:c}]}))},g.recover=function(){0==a.email.length?a.recoverAlerts.push({type:'warning',msg:'Please, provide your email.'}):(g.running=!0,g.closeRecoverAlerts(),e.get('index.php?do=resiway_user_passwordrecover&email='+a.email).then(function(a){g.running=!1;var b=a.data;'undefined'!=typeof a.data.result&&a.data.result===!0&&(g.recovery_sent=b.result)},function(){g.running=!1;var b=data.error_message_ids[0];a.recoverAlerts=[{type:'danger',msg:b}]}))}}]);